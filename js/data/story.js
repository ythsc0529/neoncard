// ========== NEON CARD GAME - STORY MODE DATA ==========
// Contains all story chapters, dialogues, and custom battle configurations

const STORY_CHAPTERS = [
    {
        id: 'main_1',
        title: '理性的崩塌與蘋果的戰爭',
        type: 'main', // 'main' 主傳, 'side' 外傳
        chapter_number: 1,
        description: '虛擬第 7 區的防線即將崩潰，迷因軍團來襲。',
        nodes: [
            // 節點 1：戰前劇情
            {
                type: 'dialogue',
                background: 'bg-wasteland', // 可以後續在CSS中加入對應的背景
                conversations: [
                    { speaker: '系統', text: '地點：虛擬第 7 區 —— 「破碎程式碼荒原」\n時間：系統重置後第 12 週期' },
                    { speaker: '旁白', text: '天空不是藍色的，而是由無數閃爍的雜訊和亂碼構成的灰白。地面上插滿了巨大的、生鏽的「一般」稀有度刀劍，像是墓碑一樣林立。' },
                    { speaker: '旁白', text: '奧本海默（神話）站在懸崖邊，推了推鼻樑上的帽子，眼神深邃而疲憊。他手中的煙斗早已熄滅，取而代之的是手中微微發光的「曼哈頓計數器」。目前的數值是 2。離那個毀滅性的臨界點還有很長一段距離。' },
                    { speaker: '愛因斯坦', text: '「我們還要等多久？」' },
                    { speaker: '旁白', text: '身後傳來一個急躁的聲音。愛因斯坦正在瘋狂地在空氣中寫寫畫畫，他的頭髮比教科書上還要亂，身邊漂浮著幾個不穩定的粒子。' },
                    { speaker: '愛因斯坦', text: '「我的『布朗運動』已經迫不及待要隨機撞擊某個倒霉鬼了，這不確定性讓我感到焦慮，或者興奮？這是相對的。」' },
                    { speaker: '奧本海默', text: '「冷靜點，阿爾伯特。這場仗不是靠你的骰子就能贏的。對面集結了『迷因軍團』的主力。」' },
                    { speaker: '愛因斯坦', text: '「迷因……毫無邏輯，違反物理定律。那個叫鯊魚鞋子的傢伙，為什麼鞋子會咬人？這不科學。」' },
                    { speaker: '旁白', text: '就在這時，通訊頻道裡傳來了刺耳的電流聲。那是前線偵查兵小圓盾最後的慘叫。' },
                    { speaker: '小圓盾 (通訊)', text: '「他們來了！太硬了！根本擋不住！那個叫彼得（Peter）的傢伙進化了——」' },
                    { speaker: '旁白', text: '訊號中斷。' },
                    { speaker: '奧本海默', text: '「全員，準備戰鬥。」' }
                ]
            },
            // 節點 2：戰鬥
            {
                type: 'battle',
                title: '遭遇戰：現實扭曲場',
                player: {
                    name: '神話聯盟',
                    deck: ['奧本海默', '愛因斯坦', '皇家騎士', '夏天與你', '超級坦克', '抽卡員', '護理師'] // 取主要的7張
                },
                enemy: {
                    name: '迷因軍團',
                    deck: ['鯊魚鞋子', '小混混', '賈伯斯', '小米', 'Peter', '科比布萊恩特', '玻璃心']
                },
                rules: {
                    customStats: {
                        'Peter': { hp: 700, maxHp: 700 }
                    }
                }
            },
            // 節點 3：戰後劇情
            {
                type: 'dialogue',
                conversations: [
                    { speaker: '旁白', text: '戰場上只剩下燃燒的殘骸、碎裂的玻璃心，以及滿地的蘋果核。' },
                    { speaker: '旁白', text: '奧本海默坐在高鐵的商務艙裡，看著窗外飛逝的風景，手中的計數器跳到了 5。' },
                    { speaker: '奧本海默', text: '「原子彈快好了。下次，我會讓羅伯特知道，什麼才是真正的咆哮。」' },
                    { speaker: '旁白', text: '而在這節車廂的角落裡，一個穿著連帽衫的神秘人正默默地洗著一副牌。' },
                    { speaker: '抽卡員', text: '「再來一次？」' },
                    { speaker: '旁白', text: '他笑了笑，從牌堆中抽出了兩張牌。一張是黑暗大法師般的結膜炎，另一張，則是那個傳說中只要死亡就能無限復活的男人——鳳凰。' },
                    { speaker: '抽卡員', text: '「好戲，才剛開始。」' }
                ]
            }
        ]
    },
    {
        id: 'main_2',
        title: '半糖少冰的埋伏與狼嚎',
        type: 'main',
        chapter_number: 2,
        description: '虛擬第 8 區 —— 「手搖飲流域（The Sugar-Ice Valley）」。大撤退後 3 小時。',
        nodes: [
            // 節點 1：對話 - 高鐵與攔路
            {
                type: 'dialogue',
                background: 'bg-wasteland',
                conversations: [
                    { speaker: '系統', text: '地點：虛擬第 8 區 —— 「手搖飲流域（The Sugar-Ice Valley）」\n時間：大撤退後 3 小時' },
                    { speaker: '旁白', text: '高鐵（傳說）巨大的白色車身在軌道上疾馳，周圍的景色從灰白的亂碼荒原，逐漸變成了色彩斑斕的液態山脈。這裡流淌著琥珀色的紅茶河，空氣中瀰漫著一股甜膩到令人窒息的果糖味。' },
                    { speaker: '旁白', text: '車廂內，氣氛凝重得像是一杯沈澱了三天的奶綠。' },
                    { speaker: '旁白', text: '護理師（稀有）正在給愛因斯坦（史詩）包紮頭部。愛因斯坦的頭髮被科比那一記後仰跳投砸得焦黑。' },
                    { speaker: '愛因斯坦', text: '「拋物線係數不對……那絕對不是球，那是高質量的黑色素粒子……」' },
                    { speaker: '旁白', text: '奧本海默（神話）坐在窗邊，手裡的煙斗火光忽明忽滅。他的「曼哈頓計數器」已經跳到了 6。距離毀滅性的臨界點 8，只差兩步。但他知道，現在引爆，會連同這輛列車一起炸飛。' },
                    { speaker: '奧本海默', text: '「我們損失了多少？」聲音沙啞。' },
                    { speaker: '旁白', text: '賈伯斯（傳說）正在擦拭他的高領衫，那上面沾染了鯊魚鞋子的口水。他厭惡地看著手中的平板。' },
                    { speaker: '賈伯斯', text: '「超級坦克訊號消失。小圓盾確認碎裂。我的股價跌了 15 個百分點。最重要的是……我的蘋果庫存只剩下 3 顆了。我無法發動『輟學』召喚庫克，現在我們沒有援軍。」' },
                    { speaker: '旁白', text: '小米（傳說）湊了過來，手裡拿著一個行動電源。' },
                    { speaker: '小米', text: '「要不要試試我的『高階研發』？只要給我一點時間充電，我可以……」' },
                    { speaker: '賈伯斯', text: '「滾。」頭都沒抬。' },
                    { speaker: '旁白', text: '就在這時，車廂內的廣播突然響起，但不是熟悉的報站聲，而是一陣刺耳的警報。' },
                    { speaker: '廣播 (系統)', text: '「警告。警告。進入高熱量危險區域。檢測到前方軌道有不明液體阻塞。速度強制下降。」' },
                    { speaker: '旁白', text: '高鐵發出了一聲沈悶的低吼，技能「誤點」被動觸發，速度-1，但最大生命值+50。車身劇烈震動，最後在一片黏稠的珍珠沼澤前停了下來。' },
                    { speaker: '戰爭女神', text: '「怎麼回事？我們被追上了？」提著矛衝到車頭。' },
                    { speaker: '奧本海默', text: '「不，是被『攔路』了。這裡是中立區，但這裡的住民……很不友善。」' },
                    { speaker: '旁白', text: '車門緩緩打開，濕熱的空氣湧入。\n攔在軌道中央的，不是怪獸，而是一群穿著制服、手裡拿著雪克杯的人。他們身後插著寫有「半糖」、「微冰」、「去冰」的旗幟，眼神空洞卻充滿殺氣。' },
                    { speaker: '梅子綠茶', text: '「過路費。不管你們是傳說還是神話，進了手搖飲流域，就要守規矩。」' },
                    { speaker: '英國紳士', text: '「我們是科學與秩序的代表，正在執行戰略轉移。這位女士，能否行個方便？」優雅地走下車，整理了一下領結。' },
                    { speaker: '梅子綠茶', text: '（冷眼），直接發動了技能「侮辱」。「你的紅茶是用茶包泡的吧？真廉價。」' },
                    { speaker: '旁白', text: '這句話如同精神攻擊。英國紳士愣住了，理智在燃燒。' },
                    { speaker: '英國紳士', text: '「無禮之徒！」舉起手杖，準備發動「喝茶」。' },
                    { speaker: '奧本海默', text: '「等等！」' },
                    { speaker: '旁白', text: '但已經來不及了。樹林兩側突然殺出兩個身影。' }
                ]
            },
            // 節點 2：戰鬥 - 手搖飲戰隊
            {
                type: 'battle',
                title: '遭遇戰：手搖飲的逆襲',
                player: {
                    name: '神話聯盟',
                    deck: ['英國紳士', '奧本海默', '愛因斯坦', '護理師', '賈伯斯', '戰爭女神', '高鐵']
                },
                enemy: {
                    name: '在地茶飲',
                    deck: ['梅子綠茶', '檸檬紅茶', '台茶18號', '採茶員', '多多綠茶', '水果茶', '烏龍茶']
                }
            },
            // 節點 3：對話 - 莫那魯道與虛無軍團
            {
                type: 'dialogue',
                conversations: [
                    { speaker: '旁白', text: '這不是普通的雜兵，這是一個完整的生態系統。源源不斷的茶飲援軍集結，但在這個時候，雙方僵持不下，一股比「茶」更原始、更野蠻的氣息籠罩了全場。' },
                    { speaker: '旁白', text: '原本喧鬧的茶飲戰隊突然安靜下來，紛紛讓開一條路。一個赤著上身、肌肉如岩石般堅硬的男人走了出來。他背著一把獵刀，眼神中燃燒著對入侵者絕對的仇恨。' },
                    { speaker: '莫那魯道', text: '「誰准你們，踩在我的獵場上？」聲音低沈，每一個字都像是敲在眾人心頭的重錘。' },
                    { speaker: '旁白', text: '他身後跟著三個身材矮小但靈活的戰士——巴萬。' },
                    { speaker: '賈伯斯', text: '「我們只是借過。我可以支付蘋果……」皺眉。' },
                    { speaker: '莫那魯道', text: '「我不吃蘋果。我只要頭顱。」拔出獵刀，技能「人頭」蓄勢待發。' },
                    { speaker: '旁白', text: '巴萬們興奮地跳躍著，發動了「圖騰」，周圍的空氣開始震盪。' },
                    { speaker: '奧本海默', text: '「麻煩了。」握緊了計數器。莫那魯道的數值非常高，如果在這裡開戰，反抗軍會被消耗殆盡。' },
                    { speaker: '旁白', text: '就在衝突一觸即發之際，天空突然暗了下來。不是烏雲，而是巨大的黑影。' },
                    { speaker: '莉安娜', text: '「找到了……小老鼠們……」一個優雅、嫵媚卻充滿血腥味的聲音從樹冠上傳來。' },
                    { speaker: '旁白', text: '巨大的黑色翅膀遮蔽了天空，那是一個穿著哥德式長裙的女人，身邊圍繞著無數吸血蝙蝠，而且蹲伏著一頭雙眼冒著紅光的巨狼。' },
                    { speaker: '梅子綠茶', text: '「那是……神話級。」手微微顫抖。在數值面前，稀有度就是階級。' },
                    { speaker: '莉安娜', text: '「把他們全部清理掉。艾倫，去吧。把他們的血條抽乾。」' },
                    { speaker: '艾倫', text: '「嗷嗚——！」發出一聲咆哮，發動技能「狼爪」，目標直指受傷最重的英國紳士。' },
                    { speaker: '旁白', text: '就在那致命的利爪即將撕碎紳士的瞬間，一道銀光閃過。鏗！獵刀與狼爪在空中碰撞，爆發出激烈的火花。擋在英國紳士面前的，竟然是莫那魯道。' },
                    { speaker: '莫那魯道', text: '「他是我的獵物。而你是……外來的野獸。」回頭看了一眼反抗軍，然後轉向艾倫，眼神變得狂熱。' },
                    { speaker: '奧本海默', text: '「別讓她得逞！那是蓄力反擊！誰有控制技能？快！」' },
                    { speaker: '城之內', text: '「我……我可以！看我的……下巴！」從高鐵的廁所裡衝了出來。' }
                ]
            },
            // 節點 4：戰鬥 - 虛無的追獵
            {
                type: 'battle',
                title: '生死戰：虛無的追獵',
                player: {
                    name: '在地勢力與神話聯盟',
                    deck: ['莫那魯道', '巴萬', '城之內', '賈伯斯', '奧本海默', '英國紳士', '高鐵']
                },
                enemy: {
                    name: '虛無軍團',
                    deck: ['莉安娜', '艾倫', '吸血蝙蝠'] // '吸血蝙蝠'可以依賴戰鬥中的死亡喚醒等能力，給個基礎池
                }
            },
            // 節點 5：對話 - 結盟與陰影
            {
                type: 'dialogue',
                conversations: [
                    { speaker: '旁白', text: '高鐵狠狠地撞擊在艾倫的腰部。這頭神話巨狼發出了淒厲的哀嚎，血條瞬間蒸發了 60%。' },
                    { speaker: '莉安娜', text: '「艾倫，撤！下次……等到Peter Pro降臨的時候，你們就沒這麼好運了……」抓起重傷的艾倫，化作一團蝙蝠消散在空中。' },
                    { speaker: '旁白', text: '戰鬥結束了。高鐵的車頭凹陷了一大塊，正在冒著蒸汽。手搖飲河被染成了紅色。莫那魯道收起獵刀，看著這群狼狽的「外來者」。' },
                    { speaker: '莫那魯道', text: '「你們很弱。但有點骨氣。」直言不諱。' },
                    { speaker: '梅子綠茶', text: '（遞給奧本海默一杯飲料）「梅子綠，半糖。喝了可以侮辱別人，加攻擊力。」' },
                    { speaker: '奧本海默', text: '（苦笑一聲接過飲料）「我們需要一個基地。虛無軍團的主力還沒動。那個叫 Peter 的傢伙……他在進化。等到他進化成 Peter Pro，或者是那個傳說中的拳王出現，我們就真的完了。」' },
                    { speaker: '莫那魯道', text: '「跟我來。山裡有個地方，他們找不到。那裡有一群……更奇怪的人。」' },
                    { speaker: '愛因斯坦', text: '「奇怪？比我們還奇怪？」' },
                    { speaker: '莫那魯道', text: '「那裡有個人叫李白（神話），整天在喝酒。還有個叫王世堅情（傳說）的，整天在跳海。你們會相處得很愉快的。」' },
                    { speaker: '旁白', text: '隊伍重新出發。這一次，反抗軍不再孤單。他們獲得了在地勢力的支援，也明白了敵人的強大。' },
                    { speaker: '旁白', text: '但在隊伍的最後，抽卡員（一般）默默地看著手中的牌。剛才的混戰中，他偷偷發動了技能。' },
                    { speaker: '抽卡員', text: '（手在顫抖）「這張牌……如果是友軍，我們無敵。如果是敵人……」' },
                    { speaker: '旁白', text: '他抽到了一張黑色的卡片。卡面上沒有數值，只有一個讓人不安的名字：阿共（一般）。HP 1000 / ATK 1000。技能：共機擾台。' },
                    { speaker: '旁白', text: '他不敢再想下去，默默把這張牌塞進了袖子裡。' },
                    { speaker: '系統提示音', text: '「特選失敗。分科測驗……準備開始。進化倒數：3 回合。」\n（在遙遠的資料中心深處，Peter 正在沈睡）' },
                    { speaker: '系統', text: '【第二章 完】' }
                ]
            }
        ]
    },
    {
        id: 'main_3',
        title: '象牙塔頂端的達爾文與特選落榜生',
        type: 'main',
        chapter_number: 3,
        description: '虛擬第 1 區 —— 「至高數據塔（The Ivory Spire）」。大撤退後 5 小時。',
        nodes: [
            // 節點 1：對話 - 至高數據塔
            {
                type: 'dialogue',
                background: 'bg-wasteland', // 可以後續替換為高科技塔背景
                conversations: [
                    { speaker: '系統', text: '地點：虛擬第 1 區 —— 「至高數據塔（The Ivory Spire）」\n時間：大撤退後 5 小時' },
                    { speaker: '旁白', text: '這裡沒有雜訊，沒有亂碼，只有完美、潔白、令人感到冰冷的幾何線條。這裡是混沌樞紐的最上層，空氣中流動的不是風，而是純度極高的算力。' },
                    { speaker: '旁白', text: '在大廳中央，懸浮著巨大的全息螢幕，上面顯示著地面戰場的實時數據。紅色的報錯點正在手搖飲流域閃爍。' },
                    { speaker: '柯 P', text: '「失敗了？」一個慵懶、甚至帶著幾分嘲弄的聲音響起。' },
                    { speaker: '旁白', text: '說話的人坐在懸浮的辦公椅上，手中轉著一把手術刀。他穿著白袍，卻不像醫生那樣救死扶傷，眼神中透著一股對世俗智商的絕對蔑視。' },
                    { speaker: '莉安娜', text: '「是戰略性撤退。」' },
                    { speaker: '旁白', text: '大廳的陰影處，蝙蝠凝聚成形。莉安娜（神話）狼狽地走了出來，她的禮服有些破損，身邊的巨狼艾倫正趴在地上舔舐著被高鐵撞擊的傷口，發出低沈的嗚咽。' },
                    { speaker: '莉安娜', text: '「那群『下等人』……他們和當地的數據流同化了。那個野蠻人獵人，還有那輛違規超速的列車……這不符合邏輯。」' },
                    { speaker: '柯 P', text: '「邏輯？」輕笑了一聲，推了推眼鏡。' },
                    { speaker: '柯 P', text: '「在這個崩壞的世界，邏輯是給弱者安慰自己的。強者只看SOP（標準作業程序）。」' },
                    { speaker: '旁白', text: '柯 P 走到艾倫身邊，手術刀在狼的傷口上比劃了一下。' },
                    { speaker: '柯 P', text: '「恢復力太差。如果是葉克膜還在的話，或許能快點。你太依賴『吸血』了，一旦被高爆發打斷，就成了廢物。」' },
                    { speaker: '莉安娜', text: '「你敢教訓我？我是神話級！」怒視著他。' },
                    { speaker: '柯 P', text: '「在這個房間裡，神話並不稀奇。」冷冷地回道。' }
                ]
            },
            // 節點 2：對話 - 決定清洗
            {
                type: 'dialogue',
                conversations: [
                    { speaker: '法特', text: '「提米……我肚子餓了……」' },
                    { speaker: '旁白', text: '大廳的另一側，地面在震動。一個體型如山的巨漢正在啃食著數據殘渣。\n法特（神話）擁有 500 點 HP 和恐怖的 60 點攻擊力，但他似乎對戰略毫無興趣。' },
                    { speaker: '法特', text: '「炸個屁……傷害 100……」含糊不清地嘟囔著，隨手抓起一個剛刷新出來的砲灰（一般），像吃薯條一樣塞進嘴裡。那个砲灰連慘叫都沒發出，就被數據刪除了。' },
                    { speaker: '柯 P', text: '「這就是我們的盟友。一個只知道吃的胖子，一個被打回來的吸血鬼，還有一個……」轉過頭，看向大廳正中央那張巨大的「王座」。' },
                    { speaker: '旁白', text: '王座上，一個少年正趴在桌上睡覺。他的呼吸平穩，但每一次呼吸，整個「至高數據塔」的燈光都會隨之明暗。Peter（神話/特殊）。' },
                    { speaker: '莉安娜', text: '「他還沒醒嗎？特選週期已經過了。」語氣中帶著一絲畏懼。' },
                    { speaker: '柯 P', text: '「數據顯示，特選失敗了。意料之中。這傢伙的設定就是『重考』與『進化』的循環。現在，他進入了更危險的階段——分科測驗。」' },
                    { speaker: '夏天與你', text: '（從天花板飄了下來，伴隨刺耳走音的旋律）「我們不能等他考上台大。」' },
                    { speaker: '旁白', text: '她的技能「太難聽」讓在場的所有人（除了睡著的 Peter）都感到一陣精神上的不適。' },
                    { speaker: '夏天與你', text: '「反抗軍正在前往『草東街』和『山海』的交界處。那裡有李白，還有那個一直在跳海的瘋子。如果讓他們匯合，再加上奧本海默的原子彈……就算是神話級也會受傷。」' },
                    { speaker: '柯 P', text: '「所以？」挑眉。' },
                    { speaker: '夏天與你', text: '「所以，我們需要執行『垃圾不分藍綠』計畫。清理掉所有低階數據，騰出算力，讓 Peter 加速進化。」' },
                    { speaker: '柯 P', text: '（沉默了片刻，然後嘴角勾起一抹殘忍的笑）「你是說，把那些沒用的盟友……全部處理掉？」' },
                    { speaker: '夏天與你', text: '「正是。」' },
                    { speaker: '旁白', text: '大廳的門打開了。一群稀有和史詩級的角色走了進來。他們是虛無軍團的預備隊。' },
                    { speaker: '扁佛狹', text: '「長官，我們發現……」剛開口，就感覺氣氛不對。' },
                    { speaker: '柯 P', text: '（轉過身，手術刀發出寒光）「你們的存在，佔用了太多的系統資源。這不是針對個人，這是為了大局。這就是……科學。」' }
                ]
            },
            // 節點 3：戰鬥 - 內部清洗 (玩家扮演柯P等反派)
            {
                type: 'battle',
                title: '內部清洗：SOP 執行中',
                player: {
                    name: '虛無軍團高層',
                    deck: ['柯 P', '莉安娜', '艾倫', '法特', '夏天與你']
                },
                enemy: {
                    name: '被拋棄的數據',
                    deck: ['扁佛狹', '骰子怪獸', '機率型選手', '砲灰', '砲灰']
                }
            },
            // 節點 4：對話 - Peter的甦醒
            {
                type: 'dialogue',
                conversations: [
                    { speaker: '旁白', text: '轟！沒有華麗的魔法，只有純粹的數據抹殺。柯 P 的攻擊像是一場精準的手術，瞬間切斷了這些中低階角色的生命線。' },
                    { speaker: '旁白', text: '扁佛狹引以為傲的「高科技」護盾在柯 P 的真實傷害面前毫無意義。機率型選手們甚至沒來得及計算閃避率，就化作了飛灰。頃刻間，大廳空蕩蕩的。' },
                    { speaker: '法特', text: '「有點吵。」打了個飽嗝。' },
                    { speaker: '柯 P', text: '「效率提高了 15%。SOP 執行完畢。」看著滿地的數據碎片。' },
                    { speaker: '旁白', text: '就在這場「內部清洗」結束的瞬間，王座上的少年動了。Peter 緩緩抬起頭。他的眼睛裡沒有瞳孔，只有無數流動的考題和公式。' },
                    { speaker: 'Peter', text: '「好吵……我正在……背單字……」聲音不大，但卻讓整個塔樓震動了一下。' },
                    { speaker: '旁白', text: 'Peter 站了起來，那股壓迫感已經截然不同。' },
                    { speaker: 'Peter', text: '「特選……沒上。為什麼……奧本海默那種老古董都能被寫進歷史課本……而我……還要考試？」喃喃自語，語氣中帶著無盡的怨念。' },
                    { speaker: 'Peter', text: '「柯文哲（柯 P）。」' },
                    { speaker: '柯 P', text: '「在。」微微低頭，但眼神依然桀驁。' },
                    { speaker: 'Peter', text: '「把羅伯特（傳說）叫回來。還有，解鎖地下室的那東西。」' },
                    { speaker: '莉安娜', text: '「你是說……那個拳（神話）？」倒吸一口涼氣。' },
                    { speaker: 'Peter', text: '「對。拳還不夠。讓他去刷爆擊率。讓他進化成拳王（特殊）。我要讓這場遊戲的難度……變成『頂標』。」' },
                    { speaker: '旁白', text: 'Peter 伸出手，指向遠方的虛擬螢幕，手指點在莫那魯道和奧本海默的頭像上。' },
                    { speaker: 'Peter', text: '「個申……造成 200 傷害。」' },
                    { speaker: '旁白', text: '他雖然人在塔頂，但技能卻穿越了空間。' }
                ]
            },
            // 節點 5：對話 - 遠方的震盪與獵殺名單
            {
                type: 'dialogue',
                conversations: [
                    { speaker: '系統', text: '地點：手搖飲流域邊緣' },
                    { speaker: '旁白', text: '正在行軍的奧本海默突然感到胸口一陣劇痛。沒有任何徵兆，他的血條憑空蒸發了 200 點！' },
                    { speaker: '奧本海默', text: '「噗！」猛地吐出一口鮮血（或者是機油），跪倒在地。' },
                    { speaker: '護理師', text: '「怎麼回事？沒有敵襲啊！」驚慌失措地衝過來。' },
                    { speaker: '奧本海默', text: '「是因果律武器……那個學生……醒了。」臉色蒼白，看著天空。' },
                    { speaker: '系統', text: '回到至高數據塔。' },
                    { speaker: '旁白', text: 'Peter 重新坐回椅子上，拿起一支筆，在虛空中寫下了一個名字。不是奧本海默，也不是莫那魯道。他寫下的是：阿共（一般）。' },
                    { speaker: 'Peter', text: '「那張牌……我感覺到了，那張牌在移動。那是不屬於這個考卷範圍的『超綱題』。必須在它被打出來之前，把它撕碎。」眉頭緊鎖。' },
                    { speaker: '柯 P', text: '「阿共……擁有 1000/1000 的面板，卻會自我傷害的瘋狂卡牌。如果讓反抗軍掌握了控制它的方法，我們的勝率會下降 40%。」若有所思。' },
                    { speaker: '莉安娜', text: '「派誰去？」' },
                    { speaker: '旁白', text: '柯 P 收起手術刀，轉身走向電梯。' },
                    { speaker: '柯 P', text: '「這次，我親自去。我去會會那個王世堅情。聽說他在那邊。老朋友了，該去敘敘舊，順便……送他最後一程。」' },
                    { speaker: '旁白', text: '電梯門關上。大廳裡只剩下法特還在咀嚼，以及Peter 翻書的聲音。' },
                    { speaker: '系統', text: '「分科測驗……倒數 1 回合。」' },
                    { speaker: '系統', text: '【第三章 完】' }
                ]
            }
        ]
    }
];

// 儲存/讀取進度
function getStoryProgress() {
    const saved = localStorage.getItem('neonCardStoryProgress');
    if (!saved) {
        return {
            unlockedNodes: { 'main_1_0': true }, // chapterId_nodeIndex
            completedNodes: {}
        };
    }
    return JSON.parse(saved);
}

function saveStoryProgress(progress) {
    localStorage.setItem('neonCardStoryProgress', JSON.stringify(progress));
}

function unlockNextNode(chapterId, currentNodeIndex) {
    let progress = getStoryProgress();
    const chapter = STORY_CHAPTERS.find(c => c.id === chapterId);
    if (!chapter) return;

    // Mark current as completed
    progress.completedNodes[`${chapterId}_${currentNodeIndex}`] = true;

    // Unlock next node in this chapter
    if (currentNodeIndex + 1 < chapter.nodes.length) {
        progress.unlockedNodes[`${chapterId}_${currentNodeIndex + 1}`] = true;
    } else {
        // Unlock next chapter's first node
        const currentChapIdx = STORY_CHAPTERS.findIndex(c => c.id === chapterId);
        if (currentChapIdx + 1 < STORY_CHAPTERS.length) {
            progress.unlockedNodes[`${STORY_CHAPTERS[currentChapIdx + 1].id}_0`] = true;
        }
    }
    saveStoryProgress(progress);
}

// 供 nodeJS (如果有的話) 或其他模塊匯出
if (typeof module !== 'undefined' && module.exports) {
    module.exports = { STORY_CHAPTERS, getStoryProgress, saveStoryProgress, unlockNextNode };
}
