<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éœ“è™¹ç‰Œ - Neon Card Game</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/theme.js"></script>
</head>

<body>
    <!-- Theme Toggle Removed -->

    <div class="menu-container">
        <h1 class="game-title neon-text">éœ“è™¹ç‰Œ</h1>
        <div class="menu-buttons">
            <button class="btn menu-btn" onclick="showModeSelection()">é–‹å§‹éŠæˆ²</button>
            <button class="btn menu-btn btn-magenta" onclick="location.href='tutorial.html'">æ–°æ‰‹æ•™å­¸</button>
            <button class="btn menu-btn btn-primary" onclick="location.href='story_menu.html'">åŠ‡æƒ…æ¨¡å¼</button>
            <button class="btn menu-btn btn-gold" onclick="location.href='characters.html'">è§’è‰²åˆ—è¡¨</button>
            <!-- æ”»ç•¥å°ˆå€ (Strategy Zone) Add Here -->
            <button class="btn menu-btn" style="border-color: #00f3ff; color: #00f3ff;"
                onclick="location.href='strategy.html'">æ”»ç•¥å°ˆå€</button>
            <button class="btn menu-btn" style="border-color: var(--neon-green); color: var(--neon-green);"
                onclick="showUpdateModal()">ç‰ˆæœ¬æ›´æ–°</button>
        </div>
    </div>

    <!-- Mode Selection Modal -->
    <div class="modal-overlay" id="modeModal">
        <div class="modal glass">
            <h2 id="modeModalTitle">é¸æ“‡å°æˆ°æ¨¡å¼</h2>

            <div class="modal-buttons" id="mainModeContainer">
                <button class="btn btn-primary" onclick="showSubMenu('pve')">å–®äººæ¨¡å¼ (å°æˆ°é›»è…¦)</button>
                <button class="btn btn-magenta" onclick="showSubMenu('pvp')">é›™äººå°æˆ° (æœ¬åœ°)</button>
                <button class="btn btn-gold" onclick="showSubMenu('online')">å¤šäººé€£ç·š (Online)</button>
                <button class="btn" onclick="closeModeModal()" style="margin-top: 20px; opacity: 0.7;">è¿”å›</button>
            </div>

            <div class="modal-buttons hidden" id="onlineTypeContainer">
                <button class="btn btn-gold" onclick="startOnlineGame('host')">å»ºç«‹æˆ¿é–“ (è‡ªå·±ç•¶ä¸»æ©Ÿ)</button>
                <div style="margin: 10px 0; color: var(--text-secondary);">æˆ–è€…</div>
                <input type="text" id="joinRoomId" placeholder="è¼¸å…¥ 4 ç¢¼é€£ç·šä»£ç¢¼"
                    style="padding: 10px; font-size: 1.2rem; text-align: center; border-radius: 5px; border: 1px solid var(--neon-cyan); background: rgba(0,0,0,0.5); color: white; width: 80%; margin: 0 auto 10px auto; text-transform: uppercase;"
                    maxlength="6">
                <button class="btn btn-cyan" onclick="startOnlineGame('join')">åŠ å…¥æˆ¿é–“</button>
                <button class="btn" onclick="showSubMenu('main')" style="margin-top: 20px; opacity: 0.7;">è¿”å›</button>
            </div>

            <div class="modal-buttons hidden" id="pveTypeContainer">
                <button class="btn" onclick="selectPvEType('quick')">å¿«é€Ÿæ¨¡å¼ (3å¼µç‰Œ)</button>
                <button class="btn btn-magenta" onclick="selectPvEType('classic')">ç¶“å…¸æ¨¡å¼ (7å¼µç‰Œ)</button>
                <button class="btn" onclick="showSubMenu('main')" style="margin-top: 20px; opacity: 0.7;">è¿”å›</button>
            </div>

            <div class="modal-buttons hidden" id="pveDiffContainer">
                <button class="btn" onclick="startGame(selectedPvEType, 'pve', 'easy')">ç°¡å–®</button>
                <button class="btn btn-danger" onclick="startGame(selectedPvEType, 'pve', 'hard')">å›°é›£</button>
                <button class="btn btn-magenta" onclick="startGame(selectedPvEType, 'pve', 'hell')">åœ°ç„</button>
                <button class="btn" onclick="showSubMenu('pve')" style="margin-top: 20px; opacity: 0.7;">è¿”å›</button>
            </div>

            <div class="modal-buttons hidden" id="pvpTypeContainer">
                <button class="btn" onclick="startGame('quick', 'pvp')">å¿«é€Ÿæ¨¡å¼ (3å¼µç‰Œ)</button>
                <button class="btn btn-magenta" onclick="startGame('classic', 'pvp')">ç¶“å…¸æ¨¡å¼ (7å¼µç‰Œ)</button>
                <button class="btn" onclick="showSubMenu('main')" style="margin-top: 20px; opacity: 0.7;">è¿”å›</button>
            </div>
        </div>
    </div>

    <!-- Tutorial Overlay -->
    <div class="tutorial-overlay hidden" id="tutorialOverlay">
        <div class="tutorial-box glass">
            <h2 class="tutorial-title" id="tutorialTitle">æ­¡è¿ä¾†åˆ°éœ“è™¹ç‰Œï¼</h2>
            <p class="tutorial-text" id="tutorialText">é€™æ˜¯ä¸€æ¬¾å°æˆ°å¡ç‰ŒéŠæˆ²ã€‚è®“æˆ‘å€‘é–‹å§‹å­¸ç¿’åŸºæœ¬è¦å‰‡å§ï¼</p>
            <div class="tutorial-buttons">
                <button class="btn" id="tutorialPrev" onclick="prevTutorial()">ä¸Šä¸€æ­¥</button>
                <button class="btn btn-magenta" id="tutorialNext" onclick="nextTutorial()">ä¸‹ä¸€æ­¥</button>
            </div>
        </div>
    </div>

    <!-- Update Modal -->
    <div class="modal-overlay" id="updateModal">
        <div class="modal glass"
            style="max-width: 800px; max-height: 80vh; text-align: left; display: flex; flex-direction: column;">
            <h2 style="text-align: center; margin-bottom: 20px;">v1.2.0 å¤§å‹å…§å®¹æ“´å±•èˆ‡å¹³è¡¡æ€§æ›´æ–°</h2>
            <div class="update-content"
                style="color: var(--text-primary); line-height: 1.6; overflow-y: auto; padding-right: 15px; font-size: 1.1rem;">

                <h3 style="color: var(--neon-cyan); margin-top: 10px; margin-bottom: 10px;">ğŸŒŸ é‡ç£…æ›´æ–°ï¼šæ–°å¢ 107 åå…¨æ–°è§’è‰²</h3>
                <ul
                    style="margin-left: 20px; margin-bottom: 20px; list-style-type: square; color: var(--text-secondary);">
                    <li>ä¸€å£æ°£å¯¦è£äº†åœ–é‘‘ç·¨è™Ÿ <strong>199 è‡³ 305</strong> çš„æ‰€æœ‰å…¨æ–°è§’è‰²ï¼</li>
                    <li>æ–°å¢å¤šç¨®å…¨æ–°æˆ°é¬¥æ©Ÿåˆ¶ï¼šåŒ…å«<strong>è³‡æºç´¯ç©èˆ‡æ¶ˆè€—ç¾è±¡</strong>ã€<strong>å‚™æˆ°å€çµ„åˆæŠ€ï¼ˆæ©Ÿç”²åˆé«”ç­‰ï¼‰</strong>ã€‚</li>
                    <li>æ–°å¢å¤šæ¨£å¼·åŠ›ç•°å¸¸ç‹€æ…‹ï¼šå¦‚<strong>é»‘æ´åå™¬ã€è‡´ç›²ã€è¡°æ¸›è­·ç›¾ã€éæ•ã€å‚¬çœ èˆ‡ä¾µè•</strong>ã€‚</li>
                    <li>å¯¦è£å…¨æ–°æŠ€èƒ½é¡å‹ï¼šåŒ…å«<strong>æ–¬æ®ºåˆ¤å®šã€æ”»æ“ŠåŠ›ç¿»å€ã€å¸è¡€ã€åå‚·ã€çŠ§ç‰²è¡€é‡é‡æ“Š</strong>ç­‰è±å¯Œå¤šè®Šçš„æˆ°è¡“é¸æ“‡ã€‚</li>
                </ul>

                <h3 style="color: var(--neon-green); margin-top: 10px; margin-bottom: 10px;">ğŸŸ¢ v1.1.0 å¢å¼·è§’è‰² (Buffs)</h3>
                <ul
                    style="margin-left: 20px; margin-bottom: 20px; list-style-type: square; color: var(--text-secondary);">
                    <li><strong style="color: var(--text-primary);">è¿ªæ–¯æŸ¥</strong>ï¼šé«”è³ªå¢å¼·ï¼ŒåŸºç¤ç”Ÿå‘½å€¼æå‡ (1 -> 50)ï¼ŒæŠ€èƒ½ã€Œå…ç–«ã€æ•˜è¿°æ›´æ¸…æ™°ã€‚
                    </li>
                    <li><strong style="color: var(--text-primary);">è˜‡è³½å¾·</strong>ï¼šæŠ€èƒ½ã€Œå…¨å“¡ç‰ç¢ã€å‚·å®³å¤§å¹…æå‡ (30 -> 50)ã€‚</li>
                    <li><strong style="color: var(--text-primary);">å»šå¸«</strong>ï¼šé«”è³ªå¢å¼·ï¼ŒåŸºç¤ç”Ÿå‘½å€¼æå‡ (150 -> 200)ã€‚</li>
                    <li><strong style="color: var(--text-primary);">è‹±åœ‹ç´³å£«</strong>ï¼šé«”è³ªå¤§å¢ï¼ŒåŸºç¤ç”Ÿå‘½å€¼ (80 -> 180) èˆ‡æ”»æ“ŠåŠ› (10 ->
                        35)ï¼Œç«™å ´èƒ½åŠ›å¤§å¹…å¼·åŒ–ã€‚</li>
                    <li><strong style="color: var(--text-primary);">é³³å‡°</strong>ï¼šç”±æ–¼æµ´ç«é‡ç”Ÿç‰¹æ€§ï¼ŒåŸºç¤ç”Ÿå‘½å€¼æå‡ (100 -> 150)ã€‚</li>
                    <li><strong style="color: var(--text-primary);">å¤§å‰</strong>ï¼šç¥ˆç¦éˆé©—ï¼Œæ–°å¢å¼·åŠ›æŠ€èƒ½ã€Œå¤§å‰é ˜ç´…èŒ¶ã€(æŠ½å‡ºä¸‰å¼µç´…èŒ¶ç‰Œ)ã€‚</li>
                    <li><strong style="color: var(--text-primary);">12äº†</strong>ï¼šé«”è³ªå¢å¼·ï¼ŒåŸºç¤ç”Ÿå‘½å€¼æå‡ (12 -> 80)ã€‚</li>
                    <li><strong style="color: var(--text-primary);">æ‹³</strong>ï¼šè¶…æ‹³æŠ€èƒ½èˆ‡è¢«å‹•çˆ†æ“Šå€ç‡å¤§å¹…å¼·åŒ– (1.3å€)ã€‚</li>
                    <li><strong style="color: var(--text-primary);">è‰æ±è¡—</strong>ï¼šé«”è³ªå¢å¼·ï¼ŒåŸºç¤ç”Ÿå‘½å€¼æå‡ (150 -> 200)ã€‚</li>
                    <li><strong style="color: var(--text-primary);">å©•åª</strong>ï¼šä¸»åŠ›æŠ€èƒ½ã€Œé¡†ç§’ã€å†·å»æ™‚é–“ç§»é™¤ (1 -> 0)ã€‚</li>
                    <li><strong style="color: var(--text-primary);">ç‹æ¬¸ç­‰</strong>ï¼šæŠ€èƒ½ã€Œå¤§è·³ã€æ–°å¢å¢åŠ æ”»æ“ŠåŠ›æ•ˆæœã€‚</li>
                    <li><strong style="color: var(--text-primary);">æ¯”äºŒè“‹ç´™</strong>ï¼šæˆç‚ºå¤§å¯Œç¿ï¼ŒåŸºç¤ç”Ÿå‘½å€¼æå‡ (200 -> 250)ï¼Œè¢«å‹•ç™¼å‹•æ¬¡æ•¸å¢åŠ è‡³ 3
                        æ¬¡ã€‚</li>
                    <li><strong style="color: var(--text-primary);">æ‘³P</strong>ï¼šè¢«å‹•ã€Œåƒåœ¾ä¸åˆ†è—ç¶ ã€é‡è£½ï¼Œç¾åœ¨æ¯æ¬¡æ–½æ”¾æŠ€èƒ½å¾Œæœƒå¢åŠ å°‘é‡æ”»æ“ŠåŠ›ã€‚</li>
                    <li><strong style="color: var(--text-primary);">å¯ç–‘è‰å¢</strong>ï¼šå¤ªå¯ç–‘äº†ï¼Œæ–°å¢ä¿å‘½èˆ‡æ‹–å»¶æŠ€èƒ½ã€Œæˆ‘å¾ˆå¯ç–‘ã€(æšˆçœ©è‡ªå·±å…©å›åˆ)ã€‚</li>
                    <li><strong style="color: var(--text-primary);">æç™½ / æå¤ªç™½</strong>ï¼šå‚³å¥‡è©©äººé«”è³ªé›™é›™åŠ å¼·ï¼ŒåŸºç¤ç”Ÿå‘½å€¼æå‡ (400 ->
                        600)ï¼Œæç™½æœ¬èº«æ”»æ“ŠåŠ›æå‡ (30 -> 50)ã€‚</li>
                    <li><strong style="color: var(--text-primary);">å¾ˆäº®çš„é­š</strong>ï¼šé«”è³ªå¢å¼·ï¼ŒåŸºç¤ç”Ÿå‘½å€¼æå‡ (250 -> 300)ã€‚</li>
                </ul>

                <h3 style="color: var(--neon-pink); margin-top: 20px; margin-bottom: 10px;">ğŸ”´ å‰Šå¼±è§’è‰² (Nerfs)</h3>
                <ul
                    style="margin-left: 20px; margin-bottom: 20px; list-style-type: square; color: var(--text-secondary);">
                    <li><strong style="color: var(--text-primary);">è¶…ç´šå¦å…‹</strong>ï¼šéæ–¼å¼·å‹¢ï¼ŒæŠ€èƒ½ã€Œè£ç”²ã€å¢åŠ  1 å›åˆå†·å»æ™‚é–“ã€‚</li>
                    <li><strong style="color: var(--text-primary);">ç¾ç§€å‰åœ˜</strong>ï¼šè¢«å‹•ã€Œå¤§è€å©†ã€é™åˆ¶æ•´å ´æˆ°é¬¥è§¸ç™¼æ¬¡æ•¸ç‚º 1 æ¬¡ã€‚</li>
                    <li><strong style="color: var(--text-primary);">é˜¿å…±</strong>ï¼šè¢«å‹•ã€Œå…±æ©Ÿæ“¾å°ã€å¾©æ´»æ©Ÿç‡é™åˆ¶ç‚º 1 æ¬¡ã€‚</li>
                    <li><strong style="color: var(--text-primary);">Peter</strong>ï¼šã€Œä¸€éšã€èˆ‡ã€ŒäºŒéšã€æ‹›å¼å†·å»æ™‚é–“å¢åŠ ï¼Œå»¶é•·é€²åŒ–æ‰€éœ€æ™‚é–“ã€‚</li>
                    <li><strong style="color: var(--text-primary);">æ€•ç˜¦åœ˜</strong>ï¼šè¢«å‹•ã€Œå¤§å¯¶ã€æ¢å¾©è¡€é‡æ¸›å°‘ (50 -> 30)ã€‚</li>
                    <li><strong style="color: var(--text-primary);">è³ˆä¼¯æ–¯max</strong>ï¼šé«”è³ªå¤§ç ï¼ŒåŸºç¤ç”Ÿå‘½å€¼ (570 -> 400) èˆ‡æ”»æ“ŠåŠ› (70 ->
                        50) ä¸‹é™ã€‚</li>
                    <li><strong style="color: var(--text-primary);">è³´éŸ‹ç¦</strong>ï¼šè¢«å‹•ã€ŒğŸ¤šã€éæ–¼éˆæ´»ï¼Œé–ƒé¿æ©Ÿç‡ä¸‹èª¿ (60% -> 35%)ã€‚</li>
                </ul>

                <h3 style="color: var(--neon-cyan); margin-top: 20px; margin-bottom: 10px;">âš¡ å¹³è¡¡æ€§èª¿æ•´ (Adjustments)</h3>
                <ul
                    style="margin-left: 20px; margin-bottom: 20px; list-style-type: square; color: var(--text-secondary);">
                    <li><strong style="color: var(--text-primary);">è­·ç†å¸«</strong>ï¼šæ”»æ“ŠåŠ›é©åº¦ä¸‹èª¿ (30 -> 20)ï¼Œä½†æŠ€èƒ½ã€Œç ä¸€åˆ€ã€å‚·å®³æå‡ (10 ->
                        30)ã€‚</li>
                    <li><strong style="color: var(--text-primary);">ç˜‹ç‹—é¨å£«</strong>ï¼šåŸºç¤ç”Ÿå‘½å€¼ä¸‹èª¿ (500 -> 400)ï¼Œä½†æ”»æ“ŠåŠ›æå‡ (5 ->
                        20)ã€‚åŒæ™‚èª¿æ•´æŠ€èƒ½å†·å»æ™‚é–“èˆ‡ç›¸é—œå€ç‡ã€‚</li>
                    <li><strong style="color: var(--text-primary);">æŠ½å¡æ™‚é–“</strong>ï¼šåŸºç¤ç”Ÿå‘½å€¼æå‡ (200 -> 230)ï¼Œä½†ç§»é™¤äº†å‰¯ä½œç”¨æŠ€èƒ½ã€Œè³£è¡€æ™‚é–“ã€ã€‚
                    </li>
                    <li><strong style="color: var(--text-primary);">æ‹³ç‹</strong>ï¼šè¢«å‹•æ–‡å­—èªªæ˜æ›´æ–°èˆ‡æ•ˆæœæ¨™æº–åŒ–ï¼Œçˆ†æ“Šå€ç‡ç‚º2.0å€ã€‚</li>
                    <li><strong style="color: var(--text-primary);">Rayç”Ÿæˆ‘å¤¢</strong>ï¼šåŸºç¤ç”Ÿå‘½å€¼æå‡ (320 ->
                        400)ï¼Œä¸€äºŒæŠ€èƒ½çš„å†·å»æ™‚é–“èˆ‡å¼·å¤§è² é¢æ•ˆæœåšäº†ç›¸å°æ‡‰çš„å¹³è¡¡ã€‚</li>
                    <li><strong style="color: var(--text-primary);">ç‹ä¸–å …æƒ…</strong>ï¼šè¢«å‹•ã€Œæœ‰å‡ºæ¯ã€å¤§å¹…é‡è£½ï¼Œç¾åœ¨ä½æ–¼ 20% è¡€é‡æ™‚å¯ä»¥åˆ·æ–°æ‰€æœ‰æŠ€èƒ½ä¸€æ¬¡ã€‚
                    </li>
                </ul>

                <h3 style="color: var(--neon-gold); margin-top: 20px; margin-bottom: 10px;">ğŸ› ï¸ ç³»çµ±èˆ‡éŠæˆ²èª¿æ•´ (System Updates)
                </h3>
                <ul
                    style="margin-left: 20px; margin-bottom: 20px; list-style-type: square; color: var(--text-secondary);">
                    <li>å…¨é¢å¯¦è£äº†åŒ…å« 32 åè§’è‰²çš„ç¬¬ä¸€æ³¢å¤§å‹å¹³è¡¡æ€§æ›´æ–°ã€‚</li>
                    <li>æ–°å¢å…¨æ–°<strong>å–®äººå°æˆ°æ¨¡å¼ (PvE)</strong>ï¼Œéš¨æ™‚å¯ä»¥æ‰¾é›»è…¦é€²è¡Œå¡ç‰Œå°æ±ºã€‚</li>
                    <li>å¯¦è£ã€Œ<strong>AI é›£åº¦å·®ç•°ç³»çµ±</strong>ã€ã€‚ç¾åœ¨å›°é›£æ¨¡å¼çš„ NPC å°‡æ‡‚å¾—ï¼šå„ªå…ˆæ–½æ”¾æŠ€èƒ½è‡ªä¿ã€æ®˜è¡€æ™‚ä¸»å‹•æ’¤é€€æ›å¥åº·éšŠå‹ã€ä»¥åŠé™£äº¡æ›äººæ™‚æœƒæŒ‘é¸æœ€å¼·è§’è‰²ä¸Šå ´ã€‚</li>
                    <li>æ–°å¢å°æˆ°ä¸­é›»è…¦æ€è€ƒæ™‚çš„ã€Œæ€è€ƒä¸­...ã€ç‰¹æ•ˆã€‚</li>
                    <li>ä¿®å¾©äº†å¤šæ¨£æŠ€èƒ½æè¿°èˆ‡å¯¦éš›ç™¼å‹•æ•ˆæœä¸ä¸€è‡´çš„å•é¡Œã€‚</li>
                    <li>é‡å°å¤šé …å¼·å¤§è¢«å‹•æŠ€èƒ½åŠ ä¸Šã€Œè§¸ç™¼æ¬¡æ•¸é™åˆ¶ã€ï¼Œé˜²æ­¢ç„¡é™å¾ªç’°ç™¼ç”Ÿã€‚</li>
                </ul>
            </div>
            <div style="margin-top: 20px; display: flex; justify-content: center;">
                <button class="btn" style="border-color: var(--neon-green); color: var(--neon-green);"
                    onclick="closeUpdateModal()">äº†è§£ï¼</button>
            </div>
        </div>
    </div>

    <!-- Network Lobby Modal -->
    <div class="modal-overlay" id="lobbyModal">
        <div class="modal glass" style="text-align: center;">
            <h2 id="lobbyTitle" class="neon-text" style="color: var(--neon-cyan);">é€£ç·šå¤§å»³</h2>
            <p id="lobbyStatus" style="margin: 20px 0; font-size: 1.2rem; color: var(--text-secondary);">åˆå§‹åŒ–ç¶²è·¯ä¸­...</p>
            <div id="lobbyRoomCode"
                style="font-size: 3rem; font-weight: bold; letter-spacing: 5px; color: var(--neon-gold); margin: 20px 0; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);"
                class="hidden"></div>
            <button class="btn" onclick="cancelLobby()" style="margin-top: 20px; opacity: 0.8;">å–æ¶ˆé€£ç·š</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="js/core/rng.js"></script>
    <script src="js/core/networkManager.js"></script>
    <script>
        let selectedPvEType = 'classic';

        function showModeSelection() {
            showSubMenu('main');
            document.getElementById('modeModal').classList.add('active');
        }

        function showSubMenu(menu) {
            document.getElementById('mainModeContainer').classList.add('hidden');
            document.getElementById('pveTypeContainer').classList.add('hidden');
            document.getElementById('pveDiffContainer').classList.add('hidden');
            document.getElementById('pvpTypeContainer').classList.add('hidden');
            if (document.getElementById('onlineTypeContainer')) document.getElementById('onlineTypeContainer').classList.add('hidden');

            if (menu === 'main') {
                document.getElementById('modeModalTitle').textContent = 'é¸æ“‡å°æˆ°æ¨¡å¼';
                document.getElementById('mainModeContainer').classList.remove('hidden');
            } else if (menu === 'pve') {
                document.getElementById('modeModalTitle').textContent = 'å–®äººæ¨¡å¼ - é¸æ“‡è¦å‰‡';
                document.getElementById('pveTypeContainer').classList.remove('hidden');
            } else if (menu === 'pvp') {
                document.getElementById('modeModalTitle').textContent = 'é›™äººå°æˆ° - é¸æ“‡è¦å‰‡';
                document.getElementById('pvpTypeContainer').classList.remove('hidden');
            } else if (menu === 'online') {
                document.getElementById('modeModalTitle').textContent = 'å¤šäººé€£ç·š - PVP';
                document.getElementById('onlineTypeContainer').classList.remove('hidden');
            }
        }

        function selectPvEType(type) {
            selectedPvEType = type;
            document.getElementById('pveTypeContainer').classList.add('hidden');
            document.getElementById('pveDiffContainer').classList.remove('hidden');
            document.getElementById('modeModalTitle').textContent = 'å–®äººæ¨¡å¼ - é¸æ“‡é›£åº¦';
        }

        function closeModeModal() {
            document.getElementById('modeModal').classList.remove('active');
        }

        function showUpdateModal() {
            document.getElementById('updateModal').classList.add('active');
        }

        function closeUpdateModal() {
            document.getElementById('updateModal').classList.remove('active');
        }

        function startGame(mode, type = 'pvp', difficulty = 'normal') {
            localStorage.setItem('gameMode', mode);
            localStorage.setItem('gameType', type);
            localStorage.setItem('pveDifficulty', difficulty);
            location.href = 'game.html';
        }

        // --- Network Lobby Logic ---
        function startOnlineGame(role) {
            localStorage.setItem('gameMode', 'online');
            localStorage.setItem('gameType', 'pvp');
            localStorage.setItem('onlineRole', role);

            if (role === 'join') {
                const roomCode = document.getElementById('joinRoomId').value.trim().toUpperCase();
                if (!roomCode) {
                    alert('è«‹è¼¸å…¥é€£ç·šä»£ç¢¼ï¼');
                    return;
                }
                localStorage.setItem('roomId', roomCode);
            }

            location.href = 'game.html';
        }

        function cancelLobby() {
            document.getElementById('lobbyModal').classList.remove('active');
        }

        // Tutorial System
        const tutorialSteps = [
            { title: 'æ­¡è¿ä¾†åˆ°éœ“è™¹ç‰Œï¼', text: 'é€™æ˜¯ä¸€æ¬¾é›™äººå°æˆ°å¡ç‰ŒéŠæˆ²ï¼Œå…©ä½ç©å®¶åœ¨åŒä¸€å°è£ç½®ä¸Šé€²è¡Œå°æˆ°ã€‚' },
            { title: 'éŠæˆ²æ¨¡å¼', text: 'å¿«é€Ÿæ¨¡å¼ï¼šæ¯ä½ç©å®¶æ“æœ‰3å¼µç‰Œ\nç¶“å…¸æ¨¡å¼ï¼šæ¯ä½ç©å®¶æ“æœ‰7å¼µç‰Œ\nè¦å‰‡ç›¸åŒï¼Œåªæœ‰ç‰Œæ•¸ä¸åŒã€‚' },
            { title: 'é–‹å±€æµç¨‹', text: '1. æ“²ç¡¬å¹£æ±ºå®šå…ˆæ‰‹\n2. é›™æ–¹æŠ½å–è§’è‰²ç‰Œ\n3. é¸æ“‡ä¸€å¼µæ”¾å…¥æˆ°é¬¥å€\n4. å…¶é¤˜æ”¾å…¥å‚™æˆ°å€' },
            { title: 'æˆ°é¬¥å€èˆ‡å‚™æˆ°å€', text: 'æˆ°é¬¥å€ï¼šé€²è¡Œæˆ°é¬¥çš„è§’è‰²ï¼ˆå„1éš»ï¼‰\nå‚™æˆ°å€ï¼šå¾…å‘½çš„è§’è‰²ï¼Œå¯é€éã€Œæ’¤é€€ã€æ›¿æ›' },
            { title: 'å›åˆè¡Œå‹•', text: 'æ¯å›åˆå¿…é ˆé¸æ“‡ä»¥ä¸‹å…¶ä¸­ä¸€å€‹è¡Œå‹•ï¼š\nâ€¢ æ™®æ”»ï¼šé€ æˆATKå€¼çš„å‚·å®³\nâ€¢ æŠ€èƒ½ï¼šä½¿ç”¨è§’è‰²æŠ€èƒ½ï¼ˆæœ‰å†·å»ï¼‰\nâ€¢ æ’¤é€€ï¼šèˆ‡å‚™æˆ°å€è§’è‰²äº¤æ›' },
            { title: 'æŠ€èƒ½å†·å»', text: 'æŠ€èƒ½æ‹¬è™Ÿä¸­çš„æ•¸å­—ä»£è¡¨å†·å»å›åˆæ•¸ã€‚\nä½¿ç”¨å¾Œéœ€ç­‰å¾…è©²å›åˆæ•¸æ‰èƒ½å†æ¬¡ä½¿ç”¨ã€‚\næ³¨æ„ï¼šå‚™æˆ°å€è§’è‰²çš„å†·å»ä¹ŸæœƒæŒçºŒè¨ˆç®—ï¼' },
            { title: 'ç‹€æ…‹æ•ˆæœ', text: 'â€¢ ç¡çœ ï¼šç„¡æ³•è¡Œå‹•ï¼Œæ¯å›åˆ50%æ©Ÿç‡ç”¦é†’\nâ€¢ æšˆçœ©ï¼šç„¡æ³•è¡Œå‹•\nâ€¢ ä¸­æ¯’/ç¼ç‡’ï¼šæ¯å›åˆå—åˆ°æŒçºŒå‚·å®³\nâ€¢ æ²‰é»˜ï¼šç„¡æ³•ä½¿ç”¨æŠ€èƒ½' },
            { title: 'å‹åˆ©æ¢ä»¶', text: 'æ“Šæ•—å°æ‰‹æ‰€æœ‰è§’è‰²å³å¯ç²å‹ï¼\nå–„ç”¨è§’è‰²ç‰¹æ€§å’ŒæŠ€èƒ½çµ„åˆä¾†å–å¾—å„ªå‹¢ã€‚' },
            { title: 'æº–å‚™å¥½äº†å—ï¼Ÿ', text: 'ç¾åœ¨ä½ å·²ç¶“äº†è§£åŸºæœ¬è¦å‰‡ï¼Œé–‹å§‹éŠæˆ²å§ï¼\nç¥ä½ éŠæˆ²æ„‰å¿«ï¼' }
        ];
        let currentStep = 0;

        function startTutorial() {
            currentStep = 0;
            document.getElementById('tutorialOverlay').classList.remove('hidden');
            updateTutorial();
        }

        function updateTutorial() {
            const step = tutorialSteps[currentStep];
            document.getElementById('tutorialTitle').textContent = step.title;
            document.getElementById('tutorialText').textContent = step.text;
            document.getElementById('tutorialPrev').style.display = currentStep === 0 ? 'none' : 'inline-block';
            document.getElementById('tutorialNext').textContent = currentStep === tutorialSteps.length - 1 ? 'å®Œæˆ' : 'ä¸‹ä¸€æ­¥';
        }

        function nextTutorial() {
            if (currentStep < tutorialSteps.length - 1) {
                currentStep++;
                updateTutorial();
            } else {
                document.getElementById('tutorialOverlay').classList.add('hidden');
            }
        }

        function prevTutorial() {
            if (currentStep > 0) {
                currentStep--;
                updateTutorial();
            }
        }

        // Update Modal Auto-Show Logic
        const APP_VERSION = '1.2.0'; // Update this string when releasing a new version

        window.addEventListener('DOMContentLoaded', () => {
            const lastSeenVersion = localStorage.getItem('lastSeenVersion');
            if (lastSeenVersion !== APP_VERSION) {
                showUpdateModal();
                localStorage.setItem('lastSeenVersion', APP_VERSION);
            }
        });

        // Close modals on outside click
        document.getElementById('modeModal').addEventListener('click', function (e) {
            if (e.target === this) closeModeModal();
        });
        document.getElementById('updateModal').addEventListener('click', function (e) {
            if (e.target === this) closeUpdateModal();
        });
    </script>
</body>

</html>